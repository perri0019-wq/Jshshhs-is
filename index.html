<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>BOOM</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{
  box-sizing:border-box;
  font-family:Arial, sans-serif;
  font-weight:bold;
}

body{
  margin:0;
  background:#0f1220;
  color:#fff;
}

/* ===== MENU ===== */
#menu{
  padding:20px;
}

.avatar-row{
  display:flex;
  align-items:center;
}

.avatar{
  width:90px;
  height:90px;
  border-radius:50%;
  background:#444;
}

.balance{
  margin-left:15px;
  flex:1;
  padding:18px;
  background:#1b1f3a;
  border-radius:22px;
  font-size:36px;
}

.bomb-btn{
  margin-top:30px;
  width:100%;
  height:25vh;
  border:5px solid #4c6fff;
  border-radius:36px;
  overflow:hidden;
  position:relative;
  cursor:pointer;
  box-shadow:0 0 40px rgba(76,111,255,.6);
}

.bomb-btn img{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
}

.bomb-btn span{
  position:relative;
  z-index:2;
  font-size:96px;
  text-shadow:0 4px 12px rgba(0,0,0,.7);
  display:flex;
  align-items:center;
  justify-content:center;
  height:100%;
}

/* ===== GAME ===== */
#game{
  display:none;
  padding:15px;
}

#menuBack{
  display:none;
  margin-bottom:10px;
}

#menuBack button{
  font-size:30px;
  padding:18px 36px;
  border-radius:24px;
}

.win{
  font-size:44px;
  margin:15px 0;
  text-align:center;
}

.grid{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:12px;
  margin:20px 0;
}

.cell{
  background:#1b1f3a;
  border-radius:20px;
  aspect-ratio:1/1;
  display:flex;
  align-items:center;
  justify-content:center;
}

.cell img{
  width:90%;
  height:90%;
}

.cell.boom{
  background:#b00020;
}

.controls{
  margin-top:20px;
  text-align:center;
}

.controls button,
.controls input{
  font-size:30px;
  padding:18px;
  margin:6px;
  border-radius:20px;
}

.range{
  width:50%;
}

#cashoutBtn{
  display:none;
  background:#2ecc71;
}
</style>
</head>

<body>

<!-- ===== MENU ===== -->
<div id="menu">
  <div class="avatar-row">
    <div class="avatar"></div>
    <div class="balance">üí∞ <span id="balance">1000.00</span></div>
  </div>

  <button class="bomb-btn" onclick="onBoomClick()">
    <img src="boom-icon.png">
    <span>BOOM</span>
  </button>
</div>

<!-- ===== GAME ===== -->
<div id="game">
  <div id="menuBack">
    <button onclick="backToMenu()">üé∞ –í –º–µ–Ω—é</button>
  </div>

  <div class="win">
    –í–æ–∑–º–æ–∂–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à:
    <span id="possibleWin">0.00</span>
    (<span id="multiplier">1.00</span>x)
  </div>

  <div class="grid" id="grid"></div>

  <div class="controls">
    <div>
      üí£ –ë–æ–º–±:
      <input type="range" min="2" max="10" value="2" class="range" id="bombRange">
      <span id="bombCount">2</span>
    </div>

    <div>
      <button onclick="halfBet()">1/2</button>
      <input type="number" id="bet" value="1" min="1">
      <button onclick="doubleBet()">2x</button>
    </div>

    <div>
      <button id="playBtn" onclick="play()">–ò–ì–†–ê–¢–¨</button>
      <button id="cashoutBtn" onclick="cashOut()">–ó–ê–ë–†–ê–¢–¨</button>
    </div>
  </div>
</div>

<script>
/* ===== SOUNDS ===== */
const boomSound = new Audio('boom.mp3');
const explodeSound = new Audio('explode.mp3');

/* ===== MULTIPLIERS ===== */
const multiplierTable = {
  2:{base:[1.09,1.28,1.33,1.5,1.75,1.9,2.1,2.5,2.8,2.95,3.3,3.6],step:0.35},
  3:{base:[1.14,1.3,1.43,1.73,2.02,2.37,2.82,3.38,4.11,5.05],step:0.8},
  4:{base:[1.19,1.43,1.73,2.11,2.61,3.26,4.13,5.32,6.95,9.27],step:3},
  5:{base:[1.25,1.58,2.02,2.61,3.43,4.61,6.2,8.49,12.16,17.3],step:7},
  6:{base:[1.32,1.75,2.37,3.26,4.57,6.53,9.54,14.31,22.12],step:8},
  7:{base:[1.39,1.96,2.8,4.3,6.2],step:3.3},
  8:{base:[1.47,2.21,3.38,5.32,8.59,14.31,24.72,44.49],step:12},
  9:{base:[1.56,2.5,4.11,6.95,11.16,22.12,42.02,84.04],step:15},
  10:{base:[1.67,2.86,5.05,9.04,17.69,35.38],step:21}
};

/* ===== STATE ===== */
let balance = 1000;
let bombs = [];
let playing = false;
let openedCount = 0;
let currentMultiplier = 1;
let betValue = 1;

/* ===== ELEMENTS ===== */
const grid = document.getElementById('grid');
const balanceEl = document.getElementById('balance');

/* ===== MENU ===== */
function onBoomClick(){
  boomSound.currentTime=0;
  boomSound.play();
  menu.style.display='none';
  game.style.display='block';
  menuBack.style.display='block';
  resetGrid();
}

function backToMenu(){
  game.style.display='none';
  menu.style.display='block';
}

/* ===== GRID ===== */
function resetGrid(){
  grid.innerHTML='';
  for(let i=0;i<25;i++){
    const c=document.createElement('div');
    c.className='cell';
    c.onclick=()=>openCell(c,i);
    grid.appendChild(c);
  }
}

/* ===== PLAY ===== */
bombRange.oninput=()=>bombCount.innerText=bombRange.value;

function play(){
  if(playing) return;

  betValue = Math.max(1, Math.min(+bet.value, balance));
  balance -= betValue;
  updateBalance();

  playing = true;
  openedCount = 0;
  currentMultiplier = 1;
  playBtn.disabled = true;
  cashoutBtn.style.display = 'none';

  bombs=[];
  while(bombs.length < +bombRange.value){
    let r=Math.floor(Math.random()*25);
    if(!bombs.includes(r)) bombs.push(r);
  }

  resetGrid();
  updateWin();
}

/* ===== CELL CLICK ===== */
function openCell(cell,index){
  if(!playing || cell.innerHTML) return;

  openedCount++;

  // üî• –ö–ê–ñ–î–û–ï 3-–ï –ü–û–õ–ï ‚Äî 40% –®–ê–ù–° –°–¢–ê–¢–¨ –†–ï–ê–õ–¨–ù–û–ô –ë–û–ú–ë–û–ô
  if(openedCount % 3 === 0 && !bombs.includes(index)){
    if(Math.random() < 0.4){
      bombs.push(index);
    }
  }

  if(bombs.includes(index)){
    explodeSound.currentTime=0;
    explodeSound.play();
    cell.classList.add('boom');
    showBombs();
    playing=false;
    playBtn.disabled=false;
    return;
  }

  const img=document.createElement('img');
  img.src='coin.png';
  cell.appendChild(img);

  updateMultiplier();
  updateWin();
  cashoutBtn.style.display='inline-block';
}

/* ===== MULTIPLIER ===== */
function updateMultiplier(){
  const t = multiplierTable[bombRange.value];
  const step = openedCount - 1;

  currentMultiplier =
    step < t.base.length
      ? t.base[step]
      : t.base[t.base.length-1] + t.step * (step - t.base.length + 1);
}

/* ===== WIN ===== */
function updateWin(){
  multiplier.innerText=currentMultiplier.toFixed(2);
  possibleWin.innerText=(betValue*currentMultiplier).toFixed(2);
}

function cashOut(){
  if(!playing) return;
  balance += betValue * currentMultiplier;
  updateBalance();
  playing=false;
  playBtn.disabled=false;
  cashoutBtn.style.display='none';
  resetGrid();
}

/* ===== HELPERS ===== */
function showBombs(){
  [...grid.children].forEach((c,i)=>{
    if(bombs.includes(i) && !c.innerHTML){
      const img=document.createElement('img');
      img.src='bomb.png';
      c.appendChild(img);
    }
  });
}

function updateBalance(){
  balanceEl.innerText = balance.toFixed(2);
}

function halfBet(){ bet.value = Math.max(1, bet.value / 2); }
function doubleBet(){ bet.value = Math.min(balance, bet.value * 2); }
</script>

</body>
</html>